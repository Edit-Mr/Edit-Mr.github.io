<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Debate Timer</title>
   <style>
      html,
      body,
      main {
         width: 100vw;
         height: 100vh;
         padding: 0;
         background-color: #212121;
         font-family: sans-serif;
         margin: 0px;
         color: #FAFAFA;
         position: relative;
         display: flex;
         justify-content: space-between;
         overflow-y: hidden;
         transition: background-color 3s ease-in-out;
      }

      h1 {
         font-size: 5em;
         position: relative;
         margin: 0;
      }

      li {
         margin: 1em;
         background-color: #424242;
         border-radius: 0.5em;
         padding: 0.5em;
         width: 20vw;
         color: #424242;
         position: relative;
      }

      aside {
         margin: 1em;
      }

      .set {
         background-color: #424242;
         border-radius: 0.5em;
         padding: 1em;
      }

      nav {
         height: 100vh;
         width: 30vw;
         overflow-y: scroll;
         overflow-x: hidden;
      }

      ul {
         padding: 0;
      }

      div[id^='stage'] {
         background-color: #30FF30;
         display: none;
         position: absolute;
         border-radius: 0.5em;
         height: 100%;
         top: 0em;
         left: 0em;
      }

      .show {
         position: absolute;
         color: #FAFAFA;
         top: 0em;
         left: 0em;
         border-radius: 0.5em;
         padding: 0.5em;
      }

      section {
         text-align: center;
         width: 60vw;
         height: 200px;
         /* 絕對定位 */
         position: absolute;
         /* 水平與垂直定位 */
         left: 50%;
         top: 50%;
         transform: translate(-50%, -50%);
      }

      label {
         font-weight: 700;
      }

      .Data-Content {
         line-height: 1.5em;
         display: flex;
         justify-content: start;
         padding: 0 1em;
      }

      .Data-Title {
         float: left;
         text-align: right;
      }

      .Data-Items {
         float: left;
      }

      h3 {
         margin: 0;
      }

      ::-webkit-scrollbar {
         width: 7px;
      }

      ::-webkit-scrollbar-button {
         background: transparent;
         border-radius: 4px;
      }

      ::-webkit-scrollbar-track-piece {
         background: transparent;
      }

      ::-webkit-scrollbar-thumb {
         border-radius: 4px;
         background-color: rgba(0, 0, 0, 0.4);
         border: 0;
      }

      ::-webkit-scrollbar-track {
         box-shadow: transparent;
      }

      input[type="number"] {
         margin: 0 0.5em;
         width: 2em;
         color: #424242;
         background-color: #b0b0b0;
         border: none;
         border-radius: .5em;
      }

      button {
         border-radius: 0.5em;
         margin-top: 0.5em;
         border: none;
         cursor: pointer;
         color: white;
         border-radius: 2px;
         box-shadow: 2px 2px 4px rgba(0, 0, 0, .4);
         background: #2196F3;
         position: relative;
         overflow: hidden;
         padding: 0.3em 0.5em;
      }

      /* Ripple magic */
      button:after {
         content: '';
         position: absolute;
         top: 50%;
         left: 50%;
         width: 5px;
         height: 5px;
         background: rgba(255, 255, 255, .5);
         opacity: 0;
         border-radius: 100%;
         transform: scale(1, 1) translate(-50%);
         transform-origin: 50% 50%;
      }

      @keyframes ripple {
         0% {
            transform: scale(0, 0);
            opacity: 1;
         }

         20% {
            transform: scale(25, 25);
            opacity: 1;
         }

         100% {
            opacity: 0;
            transform: scale(40, 40);
         }
      }

      button:focus:not(:active)::after {
         animation: ripple 1s ease-out;
      }
   </style>
</head>

<body>
   <!-- ul>(ol>div#stage$@+div.show)*11 -->
   <main>
      <nav>
         <ul>
            <li>
               <div id="stage1"></div>
               <div class="show 1">1A constructive speech</div>
               1A constructive speech
            </li>
            <li>
               <div id="stage2"></div>
               <div class="show 2">2N cross examines 1A</div>
               2N cross examines 1A
            </li>
            <li>
               <div id="stage3"></div>
               <div class="show 3">1N constructive speech</div>
               1N constructive speech
            </li>
            <li>
               <div id="stage4"></div>
               <div class="show 4">1A cross examines 1N</div>
               1A cross examines 1N
            </li>
            <li>
               <div id="stage5"></div>
               <div class="show 5">2A constructive speech</div>
               2A constructive speech
            </li>
            <li>
               <div id="stage6"></div>
               <div class="show 6">1N cross examines 2A</div>
               1N cross examines 2A
            </li>
            <li>
               <div id="stage7"></div>
               <div class="show 7">2N constructive speech</div>
               2N constructive speech
            </li>
            <li>
               <div id="stage8"></div>
               <div class="show 8">2A cross examines 2N</div>
               2A cross examines 2N
            </li>
            <li>
               <div id="stage9"></div>
               <div class="show 9">Preparation period</div>
               Preparation period
            </li>
            <li>
               <div id="stage10"></div>
               <div class="show 10">3N Rebuttal</div>
               3N Rebuttal
            </li>
            <li>
               <div id="stage11"></div>
               <div class="show 11">3A Rebuttal</div>
               3A Rebuttal
            </li>
         </ul>
      </nav>
      <aside>
         <div class="set" id="set">
            <h3>Settings</h3>
            <div class="Data-Content">
               <div class="Data-Title">
                  <label for="speech">Speech</label><br />
                  <label for="cross">Cross</label><br />
                  <label for="preparation">Preparation</label><br />
                  <label for="rebuttal">Rebuttal</label><br />
               </div>
               <div class="Data-Items">
                  <input type="number" id="speech" name="speech" min="0" max="60" value="4"><br />
                  <input type="number" id="cross" name="cross" min="0" max="60" value="2"><br />
                  <input type="number" id="preparation" name="preparation" min="0" max="60" value="5"><br />
                  <input type="number" id="rebuttal" name="rebuttal" min="0" max="60" value="3"><br />
               </div>
               <div class="Data-Items">
                  <label for="speech">mins</label><br />
                  <label for="cross">mins</label><br />
                  <label for="preparation">mins</label><br />
                  <label for="rebuttal">mins</label><br />
               </div>
            </div>
            <button id="design" onclick="dm()">Design Mode Off</button>
      </aside>
   </main>
   <section>
      <h1 id="t">Debate Timer</h1>
      <h2 id="s">By EM<br />Press space to continue</h2>
   </section>
   <script>
      const delay = (n) => new Promise(r => setTimeout(r, n));
      var status = 0;
      const section = document.querySelector('section');
      section.ontouchstart = go;
      let title = document.querySelector('h1');
      let sub = document.querySelector('h2');
      const up = new Audio("up.mp3");
      const start = new Audio("start.mp3");
      const length = document.getElementsByTagName("li").length*2;
      var history=[];
      function dm() {
         var t = document.getElementById("design");
         if (document.designMode == "on") {
            document.designMode = "off";
            t.innerText = "Design Mode Off";
         } else {
            document.designMode = "on";
            t.innerText = "Design Mode On";
         }
      }
      
      var listItems = document.querySelectorAll("li");

listItems.forEach(function(item, index) {
  item.addEventListener("click", function() {
     var status=index*2-1;
    go();
  });
});

      function fadeOut(a) {
         var fade = document.getElementById(a);
         var intervalID = setInterval(function () {
            if (!fade.style.opacity)
               fade.style.opacity = 1;
            if (fade.style.opacity > 0)
               fade.style.opacity -= 0.01;
            else
               clearInterval(intervalID);
         }, 5);
      }
      async function asyncFunction() {
         return new Promise((resolve, reject) => {
            setTimeout(() => {
               resolve('Hello, World!');
            }, 500);
         });
      }
      function fadeIn(a) {
         // set the element's initial opacity to 0
         var element = document.getElementById(a);
         element.style.opacity = 0;
         const start = performance.now();
         const animate = function (time) {
            const timePassed = time - start;
            element.style.opacity = timePassed / 500;
            if (timePassed < 500) {
               requestAnimationFrame(animate);
            }
         }

         requestAnimationFrame(animate);
      }
      document.addEventListener("keydown", (event) => {
         if (event.key === " " && document.designMode === "off") {
            go();
         }
      });
      window.onclick = e => {
         var tag = e.target.tagName;
         console.log(tag);
         if (tag == "SECTION" || tag == "H1" || tag == "H2")
            go();
      }
      async function go() {
         if (document.designMode == "on") return
         if (status > length) {
            fadeOut("t");
            fadeOut("s");
            await asyncFunction();
            title.innerText = "The End";
            sub.innerText = "Thank you for comming";
            fadeIn("s");
            fadeIn("t");
            return
         }
         status++;
         if (status == 1) { fadeOut("set"); return }
         fadeOut("s");
         if (status % 2 == 0) {
            clearInterval(interval);
            changeBackground("#212121");
            fadeOut("t");
            start.play();
            document.querySelectorAll('li')[status / 2 - 1].style = 'box-shadow:white 0px 0px 8px;';
            if (status != 2) { clearInterval(interval); document.querySelectorAll('li')[status / 2 - 2].style = 'box-shadow:none;'; }
            await asyncFunction();
            title.innerText = document.getElementsByClassName(status / 2)[0].innerText;
            sub.innerText = "Ready";
            fadeIn("t");
         }
         else {
            await asyncFunction();
            sub.innerText = "Timing";
            if(title.innerText.indexOf("speech")>-1) startTimer(document.getElementById("speech").value);
            else if(title.innerText.indexOf("cross")>-1)  startTimer(document.getElementById("cross").value);
            else if(title.innerText.indexOf("Preparation")>-1)  startTimer(document.getElementById("preparation").value);
            else if(title.innerText.indexOf("Rebuttal")>-1)  startTimer(document.getElementById("rebuttal").value);
            else alert("error:What up now?");
         }
         fadeIn("s");
         await asyncFunction();
      }
      let interval;

      function startTimer(t) {
         const max= parseFloat(t)*60;
         let time = max;
         var a = document.getElementById("stage"+(status-1)/2);
         a.style.display = "block";
         interval = setInterval(() => {
            // Decrement timer by 1 second
            time--;
            if (time < 0) sub.innerText = time; else {
               // Calculate percentage of time remaining and display it
               a.style.width = ((1 - time / max) * 100 + '%');
            }
            switch (parseInt(time)) {
               case 0:
                  title.innerText = "Time Up";
                  changeBackground("#360000");
                  up.play();
                  break;
               case 90:
                  title.innerText = "1.5 min.";
                  sub.innerText = "Left";
                  break;
               case 60:
                  title.innerText = "1 min.";
                  break;
               case 30:
                  title.innerText = "30 sec.";
                  break;
            }
         }, 1000);
      }
      function changeBackground(color) {
         const main = document.querySelector("main");
         main.style.transition = "background-color 2s ease-in-out";
         main.style.backgroundColor = color;
      }
   </script>
</body>

</html>
