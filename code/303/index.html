<!DOCTYPE html>
<html lang="en" >
   <head>
      <!-- Global site tag (gtag.js) - Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-9R5PZG2VQG"></script>
      <script>
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
         gtag('js', new Date());
         
         gtag('config', 'G-9R5PZG2VQG');
      </script>
      <meta charset="UTF-8">
      <title>303電腦課留言系統</title>
      <meta name="description" content="303電腦課留言系統">
      <meta name="keywords" content="EM's Base, Edit Mr.">
      <meta name="author" content="Elvis Mao">
      <link href="chat.png" rel="icon" type="image/x-icon">
      <link rel="stylesheet" type="text/css" href="../../css/normalize.css" media="screen">
      <link rel="stylesheet" type="text/css" href="../../css/cayman.css" media="screen">
      <link rel="stylesheet" type="text/css" href="../../css/Animate.css" media="screen">
      <link rel="stylesheet" href="style.css">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
   </head>
   <body>
      <!-- Google Tag Manager (noscript) -->
      <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NHBZ3RD"
         height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
      <!-- End Google Tag Manager (noscript) -->
      <div class="header">
      <h1 class="project-name">303電腦課留言系統</h1>
      <p>
         <a href="../../" target="_blank">毛哥EM</a>製作<br />
         發送後請稍等數秒。每秒更新訊息
      </p>
      <form action="https://script.google.com/macros/s/AKfycbyBMmqH6mir6KV1Sklt3jxr4sPVsubVjYjToGZvEfdeuw9KaZgZPtpFCc3I2vCzPLFP/exec" method="post">
         <input type="text"placeholder="顯示名稱" class="text" id="name"  autofocus/>
         <input type="text" name="msg" placeholder="訊息" id="msg" class="text" required />
         <button type="button" id="sendOrder" class="btn">新增</button>
      </form>
  </div>
      <div class="msg">
         <p id="message">
         </p>
      </div>
      <script>
         var t1 = window.setInterval(hello,1000); 
         function hello(){ 
                 let requestURL = "https://script.google.com/macros/s/AKfycbyBMmqH6mir6KV1Sklt3jxr4sPVsubVjYjToGZvEfdeuw9KaZgZPtpFCc3I2vCzPLFP/exec";
                 let request = new XMLHttpRequest();
                 request.open("GET", requestURL);
                 request.responseType = "text";
                 request.send();
                 request.onload = function () {
                    $("#message").html(request.response);
                 };
         } 
                 $(function () {
                 // 監聽 按鈕點擊
                 $("#sendOrder").click(function (e) {
                     // 姓名
                     var name = $("#name").val();
                     $("input").focus(function () {
                         $(this).css("border", "");
                     });
                     var msg = $("#msg").val();
                     // 擋住不填資料
                     if (name == "") {
                         $("#name").css("border", "1px solid #ff0000");
                     } else {
                         var data = {
                             name: name,
                             msg: msg
                         };
                         $.ajax({
                             // 這邊用get type
                             type: "post",
                             // api url - google appscript 產出的 url
                             url: "https://script.google.com/macros/s/AKfycbyBMmqH6mir6KV1Sklt3jxr4sPVsubVjYjToGZvEfdeuw9KaZgZPtpFCc3I2vCzPLFP/exec",
                             // 剛剛整理好的資料帶入
                             data: data,
                             // 資料格式是JSON
                             dataType: "JSON",
                             // 成功送出 會回頭觸發下面這塊
                             success: function (response) {
                                 console.log(response);
                                 alert("成功!!");
                             },
                         });
                     }
                 });
             });
      </script>
   </body>
</html>
