<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>座位表生成器-隨機、自訂座位 | 毛哥EM的基地</title>
  <style>
    :root {
      --settWidth: calc(50vw - 47.5vh - 2em);
      --settWidth: calc(50dvw - 47.5dvh - 2em);
      --titleWidth: calc(var(--settWidth) / 10);
      --background: #0081C9;
      --foreground: #86E5FF;

    }

    * {
      margin: 0;
      padding: 0;
      font-size: 1.5vw;
      box-sizing: border-box;
    }

    html,
    body {
      font-family: sans-serif;
      background-color: var(--background);
      display: flex;
    }

    body>div {
      position: relative;
      border-radius: var(--titleWidth);
      height: calc(100vh - 2rem);
      padding: 1rem;
      background-color: var(--foreground);
    }

    #setting,
    #delete {
      width: var(--settWidth);
      margin: 1rem 1rem 0px 1rem;
      text-align: center;
      z-index: 0;
    }

    input,
    button {
      padding: 0.5rem;
      margin: 0.25rem;
      width: 3rem;
      border: none;
      border-radius: 0.5rem;
    }

    button {
      background-color: #FFC93C;
    }

    input {
      background-color: white;
    }

    #add {
      background-color: white;
    }

    #random,
    #clear {
      width: 5rem;
      margin-top: 1rem;
    }

    #title {
      width: 5rem;
    }

    h1 {
      font-size: var(--titleWidth);
      margin: var(--titleWidth);
      margin-bottom: 0;
    }

    h2 {
      font-size: calc(var(--titleWidth) / 2);
      margin: calc(var(--titleWidth) / 3) 0 var(--titleWidth) 0;
    }

    #room {
      margin-top: 1rem;
      width: calc(100vh - 2rem);
      width: calc(100dvh - 2rem);
    }

    p {
      margin-bottom: 1rem;
    }

    @media (max-aspect-ratio: 1/1) {
      .room {
        width: 95vw;
        height: 95vw;
      }
    }

    #room div {
      user-select: none;
      -moz-user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
      background-color: #5BC0F8;
      cursor: move;
      color: white;
      border-radius: 20px;
      z-index: 5;
    }

    #room div,
    #delete {
      position: absolute;
      text-align: center;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      vertical-align: middle;
      max-width: 100%;
      max-height: 100%;
    }

    #delete div {
      width: 100%;
      height: 100%;
      border: #ff8686 5px dashed;
      border-radius: var(--titleWidth);
      display: block;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    #delete {
      top: 0;
      left: 0;
      z-index: 2;
      background-color: #ffd6d6;
      animation: fadeIn 0.5s;
      display: none;
    }

    .add {
      padding: 0.25rem;
      background-color: #FFC93C !important;
      font-size: var(--titleWidth);
    }

    img {
      width: 2rem;
      position: absolute;
      bottom: 1rem;
      left: calc(var(--settWidth) / 2 - 1rem);
    }

    p {
      margin-top: 1rem;
    }

    @keyframes fadeIn {
      0% {
        opacity: 0;
      }

      100% {
        opacity: 1;
      }
    }
  </style>
  <script>
    let activeSquare = null;
    let activeOffsetX = 0;
    let activeOffsetY = 0;
    let blockWidth;
    window.addEventListener("load", function () {
      const populationInput = document.querySelectorAll('.population');
      let room = document.getElementById("room");
      populationInput.forEach(function (populate) {
        populate.addEventListener('change', set());
      });
      populationInput.forEach(function (populate) {
        populate.addEventListener('change', set);
      });

      document.addEventListener("mousemove", function (e) {
        if (activeSquare) {
          e.preventDefault();
          var x = e.clientX - activeOffsetX;
          var y = e.clientY - activeOffsetY;
          activeSquare.style.left = x + "px";
          activeSquare.style.top = y + "px";
        }
      });
      document.addEventListener("mouseup", function (e) {
        console.log("ya");
        document.getElementById("setting").addEventListener('mouseover', function(event) {
          console.log("you're hovering over the delete button");
  if (event.type === 'mouseover') {
    activeSquare.remove();
  }else{
    console.log("you're not hovering over the delete button");
  }
});
        activeSquare = null;
        document.getElementById("delete").style.display = "none";
        
      });
    });
    function add() {
      var square = document.createElement("div");
      var title = document.getElementById("title").value;
      square.style.left = 0;
      square.style.top = 0;
      square.className = "add";
      square.innerText = title;
      room.appendChild(square);
      square.addEventListener("mousedown", function (e) {
        activeSquare = square;
        activeOffsetX = e.clientX - square.offsetLeft;
        activeOffsetY = e.clientY - square.offsetTop;

      });
      square.addEventListener("touchmove", function (e) {
        e.preventDefault();
        var touch = e.touches[0];
        console.log(e.target.style);
        e.target.style.left = "calc(" + touch.clientX + "px - var(--settWidth) - 4rem - " + blockWidth / 2 + "vw)";
        e.target.style.top = "calc(" + touch.clientY + "px - 1rem - " + blockWidth / 2 + "vw)";
      });
    }

    function clearA() {
      const elements = document.querySelectorAll('.add');
      elements.forEach((element) => {
        element.remove();
      });
    }
    function set() {
      console.log("changed");
      // Get a list of all the child elements of the container
      var children = room.children;
      for (let i = children.length - 1; i >= 0; i--) {
        const child = children[i];
        console.log(child.className);
        if (!child.className) room.removeChild(child);
      }
      // Get the computed font size of the root element in pixels
      const rootFontSize = parseFloat(getComputedStyle(document.documentElement).fontSize);
      // Calculate the pixel value of 1 rem
      const oneRemPx = rootFontSize;
      var x = parseInt(document.getElementById("x").value);
      var y = parseInt(document.getElementById("y").value);
      if (window.innerWidth < window.innerHeight) roomWidth = window.innerWidth; else roomWidth = window.innerHeight - oneRemPx * 2;
      if (x > y) var more = x; else var more = y;
      blockWidth = (roomWidth - oneRemPx * (more - 1)) / (more + 1);
      for (var i = 0; i < y; i++) {
        for (var j = 0; j < x; j++) {
          var a = document.createElement("div");
          a.style.left = blockWidth * j + blockWidth / 2 + oneRemPx * j + "px";
          a.style.top = blockWidth * i + blockWidth / 2 + oneRemPx * i + "px";
          a.style.width = blockWidth + "px";
          a.style.height = blockWidth + "px";
          a.innerText = i * x + j + 1;
          room.appendChild(a);
        }
      };
      var squares = document.querySelectorAll("#room > div");
      squares.forEach(function (square) {
        square.addEventListener("mousedown", function (e) {
          console.log("mousedown");
          document.getElementById("delete").style.display = "block";
          activeSquare = square;
          activeOffsetX = e.clientX - square.offsetLeft;
          activeOffsetY = e.clientY - square.offsetTop;
        });
        square.addEventListener("touchmove", function (e) {
          e.preventDefault();
          var touch = e.touches[0];
          console.log(e.target.style);
          e.target.style.left = "calc(" + touch.clientX + "px - var(--settWidth) - 4rem - " + blockWidth / 2 + "vw)";
          e.target.style.top = "calc(" + touch.clientY + "px - 1rem - " + blockWidth / 2 + "vw)";
        });
      });
    }
    function shuffle() {
      var blockss = room.querySelectorAll('div:not(.add)');;
      // Shuffle an array of unique numbers based on the number of blocks
      const numbers = Array.from({ length: blockss.length }, (_, i) => i + 1);
      for (let i = numbers.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [numbers[i], numbers[j]] = [numbers[j], numbers[i]];
      }
      // Assign each number to a block and update its innerHTML
      blockss.forEach((blocksss, index) => {
        const number = numbers[index];
        blocksss.innerHTML = number;
      });
    }

  </script>
</head>

<body>
  <div id="setting">
    <h1>座位表生成器</h1>
    <h2>毛哥EM製作</h2>
    人數 <input type="number" class="population" id="x" value="5" min="1">×<input type="number" class="population" id="y"
      value="5" min="1"><br>
    標示用 <input type="text" id="title" value="講桌">
    <button id="add" onclick="add()">添加</button>
    <button id="clear" onclick="clearA()">清空標示</button>
    <button id="random" onclick="shuffle()">隨機排序</button>
    <p>輸入人數會自動生成排序<br>點擊隨機排序進行洗牌<br>所有方塊均可拖曳自訂位置<br>拖曳至垃圾桶刪除方塊</p>
    <img src="trash-can.png" alt="trash-can">
  </div>
  <div id="delete">
    <div>拖曳至此刪除</div>
  </div>
  <div id="room">
  </div>
</body>

</html>